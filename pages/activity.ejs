<% include partials/header.ejs %>

<div class="row">
  <div id="event-container" class="col-sm-12">
    <div id="waiting-msg" class="card">
      <div class="card-body">
        Waiting for activity . . .
      </div>
    </div>
  </div>
</div>

<script id="json_template" type="text/x-handlebars-template"> 
  <div class="card">
    <div class="json-event card-body">
      <pre class="prettyprint linenums lang-js">{{payload}}</pre>
    </div>
  </div>
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js" type="text/javascript"></script>
<script src="/socket.io/socket.io.js" type="text/javascript"></script>
<script>
  var socket = io.connect('<%= socket_host  %>');
  socket.on('activity_event', function (data) {
    // get template
    var tmpl_source = document.getElementById('json_template').innerHTML;
    var template = Handlebars.compile(tmpl_source);
    // control max events
    if($('#event-container .card').length >= 30) {
      $('#event-container .card').last().remove();
    }
    // render
    $('#event-container').prepend(template({ payload: JSON.stringify(data, null, 2) }));
    $('#waiting-msg').hide();
  });
</script>

<% include partials/footer.ejs %>